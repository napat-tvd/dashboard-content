<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TVD Content Calendar</title>

  <style>
    /* ====== Base & Theme ====== */
    * { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg-primary: #0a0e1a;
      --bg-secondary: #0f1420;
      --bg-card: linear-gradient(145deg, rgba(20, 28, 50, 0.8), rgba(15, 20, 35, 0.6));
      --border: rgba(100, 150, 255, 0.15);
      --border-hover: rgba(100, 150, 255, 0.3);
      --text-primary: #e8eaf0;
      --text-secondary: #9ca3af;
      --text-muted: #6b7280;
      --accent-blue: #3b82f6;
      --accent-cyan: #06b6d4;
      --accent-purple: #8b5cf6;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
      --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.4), 0 10px 10px -5px rgba(0, 0, 0, 0.3);
    }

    body {
      font-family: 'Inter', 'Noto Sans Thai', system-ui, -apple-system, sans-serif;
      background: radial-gradient(ellipse at top, #1e293b 0%, var(--bg-primary) 50%);
      color: var(--text-primary);
      line-height: 1.6;
      min-height: 100vh;
      padding-bottom: 40px;
    }

    .container {
      max-width: 1800px;
      margin: 0 auto;
      padding: 24px;
    }

    /* ====== Header ====== */
    .header {
      background: var(--bg-card);
      backdrop-filter: blur(12px);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 24px 32px;
      margin-bottom: 24px;
      box-shadow: var(--shadow);
      display: flex;
      align-items: center;
      gap: 20px;
      transition: all 0.3s ease;
    }

    .logo {
      width: 56px;
      height: 56px;
      background: linear-gradient(135deg, var(--accent-blue), var(--accent-cyan));
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 28px;
      box-shadow: 0 8px 16px rgba(59, 130, 246, 0.3);
    }

    .header-content h1 {
      font-size: 28px;
      font-weight: 700;
      background: linear-gradient(90deg, var(--accent-blue), var(--accent-cyan));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 4px;
    }

    .header-subtitle {
      font-size: 14px;
      color: var(--text-secondary);
    }

    .version-badge {
      display: inline-block;
      padding: 4px 8px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      font-size: 12px;
      color: var(--text-primary);
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .version-badge:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    /* ====== Controls ====== */
    .controls-panel {
      background: var(--bg-card);
      backdrop-filter: blur(12px);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: var(--shadow);
    }

    .controls-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
    }

    button {
      padding: 12px 20px;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 10px;
      color: var(--text-primary);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      white-space: nowrap;
    }

    button:hover {
      border-color: var(--border-hover);
      transform: translateY(-2px);
      box-shadow: var(--shadow);
    }

    button.primary {
      background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
      border: none;
      color: white;
    }

    button.primary:hover {
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
    }

    /* ====== Calendar Month Header ====== */
    .calendar-header {
      text-align: center;
      margin-bottom: 24px;
      padding: 20px;
      background: var(--bg-card);
      backdrop-filter: blur(12px);
      border: 1px solid var(--border);
      border-radius: 16px;
      box-shadow: var(--shadow);
    }

    .calendar-month {
      font-size: 36px;
      font-weight: 700;
      background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 8px;
    }

    .calendar-year {
      font-size: 18px;
      color: var(--text-secondary);
    }

    /* ====== Calendar Grid ====== */
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 12px;
      margin-bottom: 24px;
    }

    .day-header {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      text-align: center;
      font-weight: 600;
      font-size: 14px;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .day-cell {
      background: var(--bg-card);
      backdrop-filter: blur(12px);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 16px;
      min-height: 180px;
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      position: relative;
      opacity: 0;
      animation: fadeInUp 0.5s ease forwards;
      animation-delay: calc(var(--index, 0) * 30ms);
    }

    .day-cell:hover {
      transform: translateY(-4px) scale(1.02);
      box-shadow: var(--shadow-lg);
      border-color: var(--border-hover);
    }

    .day-cell.other-month {
      opacity: 0.2 !important;
      pointer-events: none;
    }

    .day-cell.today {
      border-color: var(--accent-blue);
      box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
      background: linear-gradient(145deg, rgba(59, 130, 246, 0.1), rgba(15, 20, 35, 0.6));
    }

    .day-cell.today::after {
      content: 'üìç';
      position: absolute;
      top: 8px;
      left: 8px;
      font-size: 18px;
      animation: pulse 2s infinite;
    }

    .day-number {
      font-size: 24px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 12px;
    }

    .day-cell.today .day-number {
      color: var(--accent-blue);
      text-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
    }

    .day-events {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 8px;
      overflow-y: auto;
      max-height: 240px;
    }

    .day-events::-webkit-scrollbar {
      width: 4px;
    }

    .day-events::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 2px;
    }

    .day-events::-webkit-scrollbar-thumb {
      background: var(--accent-blue);
      border-radius: 2px;
    }

    .event-item {
      background: rgba(59, 130, 246, 0.08);
      border: 1px solid rgba(59, 130, 246, 0.2);
      border-radius: 12px;
      padding: 12px;
      font-size: 13px;
      transition: all 0.2s ease;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }

    .event-item::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 3px;
      background: linear-gradient(180deg, var(--accent-blue), var(--accent-purple));
    }

    .event-item:hover {
      background: rgba(59, 130, 246, 0.15);
      transform: translateX(4px);
      box-shadow: 0 2px 8px rgba(59, 130, 246, 0.2);
    }

    .event-brand {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      background: rgba(139, 92, 246, 0.15);
      border: 1px solid rgba(139, 92, 246, 0.3);
      border-radius: 6px;
      font-size: 11px;
      font-weight: 600;
      color: var(--accent-purple);
      margin-bottom: 8px;
    }

    .event-brand::before {
      content: '';
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: currentColor;
    }

    /* Brand-specific colors */
    .event-brand.suklife { 
      background: rgba(236, 72, 153, 0.15); 
      border-color: rgba(236, 72, 153, 0.3); 
      color: #ec4899; 
    }
    .event-brand.sanshiro { 
      background: rgba(168, 85, 247, 0.15); 
      border-color: rgba(168, 85, 247, 0.3); 
      color: #a855f7; 
    }
    .event-brand.angie { 
      background: rgba(244, 114, 182, 0.15); 
      border-color: rgba(244, 114, 182, 0.3); 
      color: #f472b6; 
    }
    .event-brand.bsrb { 
      background: rgba(59, 130, 246, 0.15); 
      border-color: rgba(59, 130, 246, 0.3); 
      color: #3b82f6; 
    }
    .event-brand.pestfree { 
      background: rgba(34, 197, 94, 0.15); 
      border-color: rgba(34, 197, 94, 0.3); 
      color: #22c55e; 
    }
    .event-brand.smartguard { 
      background: rgba(6, 182, 212, 0.15); 
      border-color: rgba(6, 182, 212, 0.3); 
      color: #06b6d4; 
    }
    .event-brand.sukskin { 
      background: rgba(249, 115, 22, 0.15); 
      border-color: rgba(249, 115, 22, 0.3); 
      color: #f97316; 
    }
    .event-brand.default { 
      background: rgba(139, 92, 246, 0.15); 
      border-color: rgba(139, 92, 246, 0.3); 
      color: var(--accent-purple); 
    }

    .event-content {
      color: var(--text-primary);
      font-weight: 500;
      line-height: 1.4;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
      margin-bottom: 6px;
    }

    .event-type {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 3px 8px;
      background: rgba(59, 130, 246, 0.1);
      border-radius: 6px;
      font-size: 10px;
      color: var(--accent-blue);
      font-weight: 600;
    }

    .event-type::before {
      content: 'üìù';
      font-size: 10px;
    }

    .event-count {
      position: absolute;
      top: 12px;
      right: 12px;
      background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
      color: white;
      padding: 6px 12px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 700;
      box-shadow: 0 2px 8px rgba(59, 130, 246, 0.4);
      z-index: 5;
    }

    .day-cell.today .event-count {
      background: linear-gradient(135deg, var(--accent-cyan), var(--accent-blue));
      animation: pulse 2s infinite;
    }

    /* ====== Event Brands List ====== */
    .event-brands {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 8px;
    }

    .event-brand-item {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 600;
      max-width: 100%;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .event-brand-item::before {
      content: '';
      width: 8px;
      height: 8px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .event-brand-item.more-items {
      background: rgba(100, 116, 139, 0.2);
      color: var(--text-secondary);
      font-style: italic;
    }

    /* ====== Event Popup ====== */
    .event-popup {
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      width: 280px;
      max-height: 300px;
      overflow-y: auto;
      box-shadow: var(--shadow-lg);
      z-index: 100;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .day-cell:hover .event-popup {
      opacity: 1;
      visibility: visible;
      transform: translateX(-50%) translateY(-8px);
    }

    .event-popup-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--accent-blue);
      margin-bottom: 12px;
      text-align: center;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--border);
    }

    .event-popup-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    /* ====== Mobile List View ====== */
    .mobile-list {
      display: none;
    }

    .mobile-day {
      background: var(--bg-card);
      backdrop-filter: blur(12px);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 16px;
      transition: all 0.3s ease;
      opacity: 0;
      animation: fadeInUp 0.5s ease forwards;
      animation-delay: calc(var(--index, 0) * 100ms);
    }

    .mobile-day:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    .mobile-day-header {
      font-size: 18px;
      font-weight: 700;
      color: var(--accent-blue);
      margin-bottom: 12px;
      padding-bottom: 12px;
      border-bottom: 1px solid var(--border);
    }

    .mobile-event {
      background: rgba(59, 130, 246, 0.05);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px;
      margin-bottom: 8px;
    }

    /* ====== Loading State ====== */
    .loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 400px;
      gap: 20px;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 4px solid rgba(59, 130, 246, 0.2);
      border-top-color: var(--accent-blue);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    .loading-text {
      font-size: 16px;
      color: var(--text-secondary);
      animation: pulse 2s infinite;
    }

    /* ====== Empty State ====== */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-secondary);
    }

    .empty-state-icon {
      font-size: 64px;
      margin-bottom: 16px;
      opacity: 0.5;
    }

    .empty-state-text {
      font-size: 18px;
      font-weight: 500;
    }

    /* ====== Notification ====== */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--success);
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      box-shadow: var(--shadow-lg);
      z-index: 1000;
      opacity: 0;
      transform: translateY(-20px);
      transition: all 0.3s ease;
    }

    .notification.show {
      opacity: 1;
      transform: translateY(0);
    }

    /* ====== Animations ====== */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    /* ====== Responsive ====== */
    @media (max-width: 1400px) {
      .calendar-grid {
        gap: 10px;
      }
      
      .day-cell {
        min-height: 160px;
        padding: 14px;
      }
    }

    @media (max-width: 1024px) {
      .calendar-grid {
        gap: 8px;
      }
      
      .day-cell {
        min-height: 140px;
        padding: 12px;
      }
      
      .day-number {
        font-size: 20px;
      }
      
      .event-item {
        font-size: 12px;
        padding: 10px;
      }
    }

    @media (max-width: 768px) {
      .container {
        padding: 16px;
      }

      .header {
        flex-direction: column;
        text-align: center;
      }

      .controls-grid {
        flex-direction: column;
        width: 100%;
      }

      .controls-grid button {
        width: 100%;
      }

      .calendar-grid {
        display: none;
      }

      .mobile-list {
        display: block;
      }
    }

    /* ====== Platform Icons ====== */
    .platform-icons {
      display: flex;
      gap: 6px;
      margin: 8px 0;
    }

    .platform-icon {
      width: 16px;
      height: 16px;
      fill: var(--text-secondary);
      transition: all 0.2s ease;
    }

    .platform-icon:hover {
      transform: scale(1.2);
    }

    .platform-icon.facebook:hover {
      fill: #1877f2;
    }

    .platform-icon.instagram:hover {
      fill: #e4405f;
    }

    .platform-icon.tiktok:hover {
      fill: #ff0050;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- SVG Icons Definition -->
    <svg style="display: none;">
      <symbol id="facebook-icon" viewBox="0 0 24 24">
        <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
      </symbol>
      <symbol id="instagram-icon" viewBox="0 0 24 24">
        <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
      </symbol>
      <symbol id="tiktok-icon" viewBox="0 0 24 24">
        <path d="M12.53.02C13.84 0 15.14.01 16.44 0c.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.05-2.89-.35-4.2-.97-.57-.26-1.1-.59-1.62-.93-.01 2.92.01 5.84-.02 8.75-.08 1.4-.54 2.79-1.35 3.94-1.31 1.92-3.58 3.17-5.91 3.21-1.43.08-2.86-.31-4.08-1.03-2.02-1.19-3.44-3.37-3.65-5.71-.02-.5-.03-1-.01-1.49.18-1.9 1.12-3.72 2.58-4.96 1.66-1.44 3.98-2.13 6.15-1.72.02 1.48-.04 2.96-.04 4.44-.99-.32-2.15-.23-3.02.37-.63.41-1.11 1.04-1.36 1.75-.21.51-.15 1.07-.14 1.61.24 1.64 1.82 3.02 3.5 2.87 1.12-.01 2.19-.66 2.77-1.61.19-.33.4-.67.41-1.06.1-1.79.06-3.57.07-5.36.01-4.03-.01-8.05.02-12.07z"/>
      </symbol>
    </svg>

    <!-- ====== Header ====== -->
    <div class="header">
      <div class="logo">TV</div>
      <div class="header-content">
        <h1>TVD Content Calendar</h1>
        <div class="header-subtitle">
          üì± Social Media Calendar
          <span class="version-badge">Ver.1.0.4 ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ö‡∏±‡∏Ñ ‡∏õ‡∏£‡∏±‡∏ö UI</span>
        </div>
      </div>
    </div>

    <!-- ====== Controls ====== -->
    <div class="controls-panel">
      <div class="controls-grid">
        <a href="index.html" style="text-decoration:none">
          <button>üìä Dashboard View</button>
        </a>
        <button id="prevMonthBtn">‚¨Ö ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤</button>
        <button id="thisMonthBtn" class="primary">üìç ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</button>
        <button id="nextMonthBtn">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚û°</button>
        <button id="downloadPNGBtn" class="primary">üíæ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î PNG</button>
      </div>
    </div>

    <!-- ====== Calendar Month Header ====== -->
    <div class="calendar-header">
      <div class="calendar-month" id="currentMonth">‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°</div>
      <div class="calendar-year" id="currentYear">2025</div>
    </div>

    <!-- ====== Loading State ====== -->
    <div class="loading" id="loadingState">
      <div class="spinner"></div>
      <div class="loading-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
    </div>

    <!-- ====== Calendar Grid (Desktop) ====== -->
    <div class="calendar-grid" id="calendarGrid" style="display: none;">
      <!-- Day headers -->
      <div class="day-header">‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå</div>
      <div class="day-header">‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå</div>
      <div class="day-header">‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£</div>
      <div class="day-header">‡∏û‡∏∏‡∏ò</div>
      <div class="day-header">‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ</div>
      <div class="day-header">‡∏®‡∏∏‡∏Å‡∏£‡πå</div>
      <div class="day-header">‡πÄ‡∏™‡∏≤‡∏£‡πå</div>
      <!-- Day cells will be inserted here -->
    </div>

    <!-- ====== Mobile List View ====== -->
    <div class="mobile-list" id="mobileList">
      <!-- Mobile day items will be inserted here -->
    </div>
  </div>

  <!-- Notification -->
  <div class="notification" id="notification"></div>

  <!-- ====== Libraries ====== -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <!-- ====== App Script ====== -->
  <script>
    /* ==============================
       CONFIG
    =============================== */
    const CONFIG = {
      SHEET_URL: 'https://script.google.com/macros/s/AKfycbwl-pTotzeMuRwDEmSbdNbt6OeeOR7TUtQKUYqREm-QI8eENIrfN7dWCXBipwIIAubm/exec?view=calendar'
    };

    /* ==============================
       STATE
    =============================== */
    let data = [];
    let currentDate = new Date();
    let latestDate = null;

    /* ==============================
       HELPERS
    =============================== */
    const THAI_MONTH_NAMES = [
      '‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå', '‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°', '‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô', '‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°', '‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô',
      '‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°', '‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô', '‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°', '‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô', '‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'
    ];

    function parseDate(dateStr) {
      if (!dateStr) return null;
      
      // Handle YYYY-MM-DD format
      if (/^\d{4}-\d{2}-\d{2}$/.test(dateStr)) {
        const date = new Date(dateStr + 'T00:00:00');
        return date;
      }
      
      // Handle DD/MM/YYYY format
      const dmyMatch = dateStr.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);
      if (dmyMatch) {
        const [_, day, month, year] = dmyMatch;
        return new Date(parseInt(year), parseInt(month) - 1, parseInt(day));
      }
      
      return null;
    }

    function getBrandClass(brand) {
      const b = (brand || '').toLowerCase().trim();
      if (b.includes('suklife')) return 'suklife';
      if (b.includes('sanshiro')) return 'sanshiro';
      if (b.includes('angie')) return 'angie';
      if (b.includes('bsrb')) return 'bsrb';
      if (b.includes('pestfree')) return 'pestfree';
      if (b.includes('smart')) return 'smartguard';
      if (b.includes('sukskin')) return 'sukskin';
      if (b.includes('‡∏Å‡∏≤‡πÅ‡∏ü‡∏°‡∏µ‡∏™‡∏∏‡∏Ç')) return 'default';
      if (b.includes('‡∏î‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏ô‡∏î‡∏µ')) return 'default';
      if (b.includes('‡πÄ‡∏û‡∏£‡∏µ‡∏¢‡∏ß‡∏•‡∏°')) return 'default';
      return 'default';
    }

    function getBrandColor(brand) {
      const b = (brand || '').toLowerCase().trim();
      if (b.includes('suklife')) return '#ec4899';
      if (b.includes('sanshiro')) return '#a855f7';
      if (b.includes('angie')) return '#f472b6';
      if (b.includes('bsrb')) return '#3b82f6';
      if (b.includes('pestfree')) return '#22c55e';
      if (b.includes('smart')) return '#06b6d4';
      if (b.includes('sukskin')) return '#f97316';
      return '#8b5cf6';
    }

    function showNotification(message, type = 'success') {
      const notification = document.getElementById('notification');
      notification.textContent = message;
      notification.style.background = type === 'success' ? 'var(--success)' : 'var(--danger)';
      notification.classList.add('show');
      
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }

    /* ==============================
       LOAD DATA
    =============================== */
    async function loadData() {
      const loadingState = document.getElementById('loadingState');
      
      try {
        if (!CONFIG.SHEET_URL) throw new Error('No URL');

        const res = await fetch(CONFIG.SHEET_URL, { 
          headers: { 'Accept': 'application/json' },
          cache: 'no-cache'
        });
        
        if (!res.ok) throw new Error(`HTTP ${res.status}`);

        const result = await res.json();
        data = result.rows || [];
        
        console.log('Data loaded:', data.length, 'rows');
        if (data.length > 0) {
          console.log('Sample row:', data[0]);
        }
        
        // Find latest date in data - Support both field names
        data.forEach(row => {
          const dateStr = row['‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà'] || row['Date'] || row['Date_Text'];
          const date = parseDate(dateStr);
          if (date && (!latestDate || date > latestDate)) {
            latestDate = date;
          }
        });
        
        // Set to current month by default (not latest month)
        currentDate = new Date();
        
        loadingState.style.display = 'none';
        document.getElementById('calendarGrid').style.display = 'grid';
        
        renderCalendar();
        showNotification(`‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${data.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`, 'success');
      } catch (error) {
        console.error('Load error:', error);
        loadingState.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">‚ö†Ô∏è</div>
            <div class="empty-state-text">‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</div>
          </div>
        `;
        showNotification('‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'error');
      }
    }

    /* ==============================
       CALENDAR RENDERING
    =============================== */
    function renderCalendar() {
      const year = currentDate.getFullYear();
      const month = currentDate.getMonth();

      // Update header
      document.getElementById('currentMonth').textContent = THAI_MONTH_NAMES[month];
      document.getElementById('currentYear').textContent = year;

      // Get first and last day of month
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const startDay = firstDay.getDay();
      const daysInMonth = lastDay.getDate();

      // Get previous month's last days
      const prevMonthLastDay = new Date(year, month, 0).getDate();

      // Organize events by date
      const eventsByDate = {};
      data.forEach(row => {
        // Support multiple field names
        const dateStr = row['‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà'] || row['Date'] || row['Date_Text'];
        const date = parseDate(dateStr);
        if (!date) return;

        if (date.getFullYear() === year && date.getMonth() === month) {
          const day = date.getDate();
          if (!eventsByDate[day]) eventsByDate[day] = [];
          
          // Map field names to expected format
          const mappedRow = {
            '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà': dateStr,
            'Brand': row['Brand'] || row['Product'] || row['‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå'],
            'Type': row['Type'] || row['‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó'],
            '‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤': row['‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤'] || row['Topic'] || row['‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤'],
            'Content Pillar': row['Content Pillar'] || row['‡πÄ‡∏™‡∏≤‡∏´‡∏•‡∏±‡∏Å'],
            'Platform': row['Platform'] || row['‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°'],
            'Status': row['Status'] || row['‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞']
          };
          
          eventsByDate[day].push(mappedRow);
        }
      });

      // Render desktop calendar grid
      const calendarGrid = document.getElementById('calendarGrid');
      // Clear previous cells (keep headers)
      while (calendarGrid.children.length > 7) {
        calendarGrid.removeChild(calendarGrid.lastChild);
      }

      let cellIndex = 0;

      // Previous month's days
      for (let i = startDay - 1; i >= 0; i--) {
        const dayCell = createDayCell(prevMonthLastDay - i, [], true, cellIndex++);
        calendarGrid.appendChild(dayCell);
      }

      // Current month's days
      const today = new Date();
      const todayYear = today.getFullYear();
      const todayMonth = today.getMonth();
      const todayDate = today.getDate();
      
      for (let day = 1; day <= daysInMonth; day++) {
        const events = eventsByDate[day] || [];
        const isToday = todayYear === year && 
                       todayMonth === month && 
                       todayDate === day;
        const dayCell = createDayCell(day, events, false, cellIndex++, isToday);
        calendarGrid.appendChild(dayCell);
      }

      // Next month's days to fill grid
      const totalCells = calendarGrid.children.length - 7;
      const remainingCells = (Math.ceil(totalCells / 7) * 7) - totalCells;
      for (let day = 1; day <= remainingCells; day++) {
        const dayCell = createDayCell(day, [], true, cellIndex++);
        calendarGrid.appendChild(dayCell);
      }

      // Render mobile list
      renderMobileList(eventsByDate, year, month);
    }

    function createDayCell(day, events, otherMonth, index, isToday = false) {
      const cell = document.createElement('div');
      cell.className = `day-cell ${otherMonth ? 'other-month' : ''} ${isToday ? 'today' : ''}`;
      cell.style.setProperty('--index', index);

      const dayNumber = document.createElement('div');
      dayNumber.className = 'day-number';
      dayNumber.textContent = day;
      cell.appendChild(dayNumber);

      if (events.length > 0) {
        const eventCount = document.createElement('div');
        eventCount.className = 'event-count';
        eventCount.textContent = events.length;
        cell.appendChild(eventCount);

        // Create event brands list (max 3 items)
        if (events.length > 0) {
          const eventBrands = document.createElement('div');
          eventBrands.className = 'event-brands';
          
          const maxItems = 3;
          const itemsToShow = Math.min(events.length, maxItems);
          
          for (let i = 0; i < itemsToShow; i++) {
            const event = events[i];
            const brandItem = document.createElement('div');
            brandItem.className = 'event-brand-item';
            brandItem.style.backgroundColor = `${getBrandColor(event.Brand)}20`;
            brandItem.style.color = getBrandColor(event.Brand);
            brandItem.style.border = `1px solid ${getBrandColor(event.Brand)}40`;
            
            const brandName = event.Brand || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå';
            brandItem.textContent = brandName.length > 20 ? brandName.substring(0, 20) + '...' : brandName;
            
            brandItem.setAttribute('title', brandName);
            eventBrands.appendChild(brandItem);
          }
          
          // Show "more items" indicator if there are more events
          if (events.length > maxItems) {
            const moreItems = document.createElement('div');
            moreItems.className = 'event-brand-item more-items';
            moreItems.textContent = `+ ${events.length - maxItems} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∑‡πà‡∏ô‡πÜ`;
            eventBrands.appendChild(moreItems);
          }
          
          cell.appendChild(eventBrands);
        }

        // Create event popup
        const eventPopup = document.createElement('div');
        eventPopup.className = 'event-popup';
        
        const popupTitle = document.createElement('div');
        popupTitle.className = 'event-popup-title';
        popupTitle.textContent = `${day} ${THAI_MONTH_NAMES[currentDate.getMonth()]} ${currentDate.getFullYear()} (${events.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)`;
        eventPopup.appendChild(popupTitle);
        
        const popupList = document.createElement('div');
        popupList.className = 'event-popup-list';
        
        events.forEach(event => {
          const eventItem = createEventItem(event);
          popupList.appendChild(eventItem);
        });
        
        eventPopup.appendChild(popupList);
        cell.appendChild(eventPopup);
      }

      return cell;
    }

    function createEventItem(event) {
      const item = document.createElement('div');
      item.className = 'event-item';
      item.title = event['‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤'] || '';

      // Brand tag
      if (event.Brand) {
        const brand = document.createElement('span');
        brand.className = `event-brand ${getBrandClass(event.Brand)}`;
        brand.textContent = event.Brand;
        item.appendChild(brand);
      }

      // Content
      const content = document.createElement('div');
      content.className = 'event-content';
      content.textContent = event['‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤'] || '-';
      item.appendChild(content);

      // Platform icons
      if (event.Platform) {
        const platformsWrapper = document.createElement('div');
        platformsWrapper.className = 'platform-icons';
        
        const platforms = event.Platform.split(',').map(p => p.trim().toUpperCase());
        
        if (platforms.includes('FACEBOOK')) {
          const icon = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
          icon.classList.add('platform-icon', 'facebook');
          icon.innerHTML = '<use href="#facebook-icon"/>';
          platformsWrapper.appendChild(icon);
        }
        
        if (platforms.includes('INSTAGRAM')) {
          const icon = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
          icon.classList.add('platform-icon', 'instagram');
          icon.innerHTML = '<use href="#instagram-icon"/>';
          platformsWrapper.appendChild(icon);
        }
        
        if (platforms.includes('TIKTOK')) {
          const icon = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
          icon.classList.add('platform-icon', 'tiktok');
          icon.innerHTML = '<use href="#tiktok-icon"/>';
          platformsWrapper.appendChild(icon);
        }

        item.appendChild(platformsWrapper);
      }

      // Type badge
      if (event.Type) {
        const type = document.createElement('span');
        type.className = 'event-type';
        type.textContent = event.Type;
        item.appendChild(type);
      }

      return item;
    }

    function renderMobileList(eventsByDate, year, month) {
      const mobileList = document.getElementById('mobileList');
      mobileList.innerHTML = '';

      const days = Object.keys(eventsByDate).sort((a, b) => parseInt(a) - parseInt(b));

      if (days.length === 0) {
        mobileList.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">üìÖ</div>
            <div class="empty-state-text">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</div>
          </div>
        `;
        return;
      }

      days.forEach((day, index) => {
        const events = eventsByDate[day];
        const mobileDay = document.createElement('div');
        mobileDay.className = 'mobile-day';
        mobileDay.style.setProperty('--index', index);

        const header = document.createElement('div');
        header.className = 'mobile-day-header';
        header.textContent = `${day} ${THAI_MONTH_NAMES[month]} ${year} (${events.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)`;
        mobileDay.appendChild(header);

        events.forEach(event => {
          const eventItem = createEventItem(event);
          eventItem.classList.add('mobile-event');
          mobileDay.appendChild(eventItem);
        });

        mobileList.appendChild(mobileDay);
      });
    }

    /* ==============================
       EVENT HANDLERS
    =============================== */
    document.getElementById('prevMonthBtn').addEventListener('click', () => {
      currentDate.setMonth(currentDate.getMonth() - 1);
      renderCalendar();
    });

    document.getElementById('nextMonthBtn').addEventListener('click', () => {
      currentDate.setMonth(currentDate.getMonth() + 1);
      renderCalendar();
    });

    document.getElementById('thisMonthBtn').addEventListener('click', () => {
      currentDate = new Date();
      renderCalendar();
    });

    document.getElementById('downloadPNGBtn').addEventListener('click', () => {
      const calendarGrid = document.getElementById('calendarGrid');
      html2canvas(calendarGrid, {
        backgroundColor: '#0a0e1a',
        scale: 2,
        useCORS: true
      }).then(canvas => {
        const link = document.createElement('a');
        link.download = `calendar-${currentDate.getFullYear()}-${currentDate.getMonth() + 1}.png`;
        link.href = canvas.toDataURL('image/png');
        link.click();
        showNotification('‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î PNG ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
      }).catch(err => {
        console.error('Download error:', err);
        showNotification('‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'error');
      });
    });

    /* ==============================
       INIT
    =============================== */
    document.addEventListener('DOMContentLoaded', () => {
      loadData();
    });
  </script>
</body>
</html>
