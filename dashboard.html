<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TVD Content Dashboard</title>

  <style>
    /* ====== Base & Theme ====== */
    * { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg-primary: #0a0e1a;
      --bg-secondary: #0f1420;
      --bg-card: linear-gradient(145deg, rgba(20, 28, 50, 0.8), rgba(15, 20, 35, 0.6));
      --border: rgba(100, 150, 255, 0.15);
      --border-hover: rgba(100, 150, 255, 0.3);
      --text-primary: #e8eaf0;
      --text-secondary: #9ca3af;
      --text-muted: #6b7280;
      --accent-blue: #3b82f6;
      --accent-cyan: #06b6d4;
      --accent-purple: #8b5cf6;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
      --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.4), 0 10px 10px -5px rgba(0, 0, 0, 0.3);
      --glow-blue: 0 0 15px rgba(59, 130, 246, 0.5);
      --glow-cyan: 0 0 15px rgba(6, 182, 212, 0.5);
      --glow-purple: 0 0 15px rgba(139, 92, 246, 0.5);
    }

    body {
      font-family: 'Inter', 'Noto Sans Thai', system-ui, -apple-system, sans-serif;
      background: radial-gradient(ellipse at top, #1e293b 0%, var(--bg-primary) 50%);
      color: var(--text-primary);
      line-height: 1.6;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* ====== Navbar ====== */
    .navbar {
      background: var(--bg-card);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border);
      padding: 16px 32px;
      box-shadow: var(--shadow);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .navbar-container {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 24px;
    }

    .navbar-brand {
      display: flex;
      align-items: center;
      gap: 12px;
      text-decoration: none;
      font-weight: 700;
      font-size: 18px;
      color: var(--text-primary);
    }

    .navbar-logo {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, var(--accent-blue), var(--accent-cyan));
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 20px;
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    }

    .navbar-nav {
      display: flex;
      align-items: center;
      gap: 8px;
      flex: 1;
    }

    .nav-link {
      padding: 10px 18px;
      background: transparent;
      border: 1px solid transparent;
      border-radius: 8px;
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      white-space: nowrap;
    }

    .nav-link:hover {
      color: var(--text-primary);
      border-color: var(--border-hover);
      background: rgba(255, 255, 255, 0.05);
    }

    .nav-link.active {
      background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
      color: white;
      border-color: transparent;
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    }

    .container {
      flex: 1;
      max-width: 1400px;
      margin: 0 auto;
      padding: 24px;
      width: 100%;
    }

    /* ====== Header ====== */
    .header {
      background: var(--bg-card);
      backdrop-filter: blur(12px);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 24px 32px;
      margin-bottom: 24px;
      box-shadow: var(--shadow);
      display: flex;
      align-items: center;
      gap: 20px;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .header::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.1), transparent);
      transition: left 0.6s ease;
    }

    .header:hover::before {
      left: 100%;
    }

    .logo {
      width: 56px;
      height: 56px;
      background: linear-gradient(135deg, var(--accent-blue), var(--accent-cyan));
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 24px;
      box-shadow: 0 8px 16px rgba(59, 130, 246, 0.3);
      transition: all 0.3s ease;
    }

    .logo:hover {
      transform: scale(1.05);
      box-shadow: var(--glow-blue);
    }

    .header-content h1 {
      font-size: 28px;
      font-weight: 700;
      background: linear-gradient(90deg, var(--accent-blue), var(--accent-cyan));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 4px;
      position: relative;
    }

    .header-subtitle {
      font-size: 14px;
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .version-badge {
      background: rgba(139, 92, 246, 0.1);
      border: 1px solid rgba(139, 92, 246, 0.3);
      border-radius: 6px;
      padding: 2px 8px;
      font-size: 11px;
      font-weight: 600;
      color: var(--accent-purple);
    }

    .status-badge {
      margin-left: auto;
      padding: 8px 16px;
      background: rgba(16, 185, 129, 0.1);
      border: 1px solid rgba(16, 185, 129, 0.3);
      border-radius: 999px;
      font-size: 13px;
      color: var(--success);
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .status-badge:hover {
      box-shadow: 0 0 10px rgba(16, 185, 129, 0.3);
    }

    /* ====== Tabs ====== */
    .nav-tabs { display: flex; gap: 8px; margin-bottom: 24px; }
    .nav-tab {
      padding: 12px 24px;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 12px;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
      font-size: 14px;
      position: relative;
      overflow: hidden;
    }
    .nav-tab::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
      transition: left 0.5s ease;
    }
    .nav-tab:hover::before {
      left: 100%;
    }
    .nav-tab:hover { 
      border-color: var(--border-hover); 
      transform: translateY(-2px); 
      box-shadow: var(--shadow);
    }
    .nav-tab.active {
      background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
      color: white;
      border-color: transparent;
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
    }

    /* ====== Filters ====== */
    .filters-panel {
      background: var(--bg-card);
      backdrop-filter: blur(12px);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: var(--shadow);
      transition: all 0.3s ease;
    }

    .filters-panel:hover {
      box-shadow: var(--shadow-lg);
    }

    .filters-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 16px;
      margin-bottom: 16px;
    }

    .filter-group { display: flex; flex-direction: column; gap: 8px; }

    .filter-label {
      font-size: 13px;
      font-weight: 500;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    input, select {
      width: 100%;
      padding: 12px 16px;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 10px;
      color: var(--text-primary);
      font-size: 14px;
      transition: all 0.3s ease;
      outline: none;
    }

    input:focus, select:focus {
      border-color: var(--accent-blue);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .date-range { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }

    .action-buttons { display: flex; gap: 12px; flex-wrap: wrap; }

    button {
      padding: 12px 20px;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 10px;
      color: var(--text-primary);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      white-space: nowrap;
      position: relative;
      overflow: hidden;
    }

    button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
      transition: left 0.5s ease;
    }

    button:hover::before {
      left: 100%;
    }

    button:hover { 
      border-color: var(--border-hover); 
      transform: translateY(-2px); 
      box-shadow: var(--shadow);
    }
    button.primary { 
      background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple)); 
      border: none; 
      color: white; 
    }
    button.primary:hover { 
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4), var(--glow-blue);
    }

    /* ====== KPI ====== */
    .kpi-grid { 
      display: grid;
      gap: 16px;
      margin-bottom: 24px;
      grid-template-rows: auto auto;
    }
    
    .kpi-row {
      display: grid;
      gap: 16px;
      grid-template-columns: repeat(4, 1fr);
    }
    
    .kpi-card {
      background: var(--bg-card); 
      backdrop-filter: blur(12px); 
      border: 1px solid var(--border);
      border-radius: 16px; 
      padding: 20px; 
      box-shadow: var(--shadow); 
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      position: relative;
      transform-origin: center;
      animation: fadeInUp 0.6s ease backwards;
      animation-delay: calc(var(--order, 0) * 100ms);
    }
    .kpi-card::before { 
      content: ''; 
      position: absolute; 
      top: 0; 
      left: 0; 
      right: 0; 
      height: 3px; 
      background: linear-gradient(90deg, var(--accent-blue), var(--accent-cyan)); 
    }
    .kpi-card:hover { 
      transform: translateY(-4px) scale(1.02) rotate(-0.5deg);
      box-shadow: var(--shadow-lg), 
                  0 0 20px rgba(59, 130, 246, 0.2),
                  0 0 40px rgba(59, 130, 246, 0.1);
      border-color: var(--border-hover); 
    }
    .kpi-label { 
      font-size: 13px; 
      color: var(--text-secondary); 
      text-transform: uppercase; 
      letter-spacing: 0.5px; 
      margin-bottom: 8px; 
      font-weight: 600; 
    }
    .kpi-value { 
      font-size: 32px; 
      font-weight: 700; 
      color: var(--accent-blue);
      animation: countUp 1.5s ease-out backwards;
      animation-delay: calc((var(--order, 0) * 100ms) + 300ms);
    }
    
    .kpi-subvalue {
      font-size: 12px;
      color: var(--text-secondary);
      font-weight: 500;
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(59, 130, 246, 0.1);
      padding: 4px 8px;
      border-radius: 6px;
      border: 1px solid rgba(59, 130, 246, 0.2);
    }

    /* ====== Charts ====== */
    .charts-grid { 
      display: grid; 
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); 
      gap: 16px; 
      margin-bottom: 24px; 
    }
    .chart-card { 
      background: var(--bg-card); 
      backdrop-filter: blur(12px); 
      border: 1px solid var(--border); 
      border-radius: 16px; 
      padding: 28px; 
      box-shadow: var(--shadow); 
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      height: 450px;
      display: flex;
      flex-direction: column;
      animation: fadeInUp 0.8s ease backwards;
      animation-delay: calc(var(--order, 0) * 200ms);
    }
    .chart-card:hover {
      transform: translateY(-5px);
      border-color: var(--border-hover);
      box-shadow: var(--shadow-lg),
                  0 0 25px rgba(59, 130, 246, 0.15),
                  0 0 50px rgba(59, 130, 246, 0.1);
    }
    .chart-title { 
      font-size: 16px; 
      font-weight: 600; 
      margin-bottom: 20px;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .chart-title::before {
      content: '';
      display: block;
      width: 4px;
      height: 16px;
      background: linear-gradient(to bottom, var(--accent-blue), var(--accent-purple));
      border-radius: 2px;
    }
    .chart-container {
      flex: 1;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* ====== Table ====== */
    .table-container { 
      background: var(--bg-card); 
      backdrop-filter: blur(12px); 
      border: 1px solid var(--border); 
      border-radius: 16px; 
      overflow: hidden; 
      box-shadow: var(--shadow); 
      transition: all 0.3s ease;
      animation: fadeInUp 1s ease backwards;
      animation-delay: 800ms;
    }
    .table-container:hover {
      box-shadow: var(--shadow-lg);
    }
    .table-wrapper { overflow-x: auto; }
    table { width: 100%; border-collapse: collapse; min-width: 1200px; }
    thead { background: var(--bg-secondary); position: sticky; top: 0; z-index: 10; }
    th {
      padding: 16px; text-align: left; font-size: 12px; font-weight: 600; color: var(--text-secondary);
      text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 1px solid var(--border);
      cursor: pointer; user-select: none; transition: all 0.3s ease;
    }
    th:hover { 
      color: var(--accent-blue); 
      background: rgba(59, 130, 246, 0.05);
    }
    td { 
      padding: 16px; 
      border-bottom: 1px solid var(--border); 
      font-size: 14px; 
      transition: all 0.2s ease;
    }
    tbody tr { transition: background 0.2s ease; }
    tbody tr:hover { 
      background: rgba(59, 130, 246, 0.05); 
      transform: translateX(4px);
    }
    tbody tr {
      animation: fadeIn 0.5s ease backwards;
      animation-delay: calc(var(--row-index, 0) * 50ms);
    }

    /* ====== Badges ====== */
    .badge { 
      display: inline-flex; 
      align-items: center; 
      gap: 6px; 
      padding: 6px 12px; 
      border-radius: 999px; 
      font-size: 12px; 
      font-weight: 600; 
      border: 1px solid; 
      transition: all 0.3s ease;
    }
    .badge:hover {
      transform: scale(1.05);
    }
    .badge::before { content: ''; width: 6px; height: 6px; border-radius: 50%; display: inline-block; }
    .badge-done    { background: rgba(16,185,129, .1); border-color: rgba(16,185,129,.3); color: var(--success); }
    .badge-done::before { background: var(--success); }
    .badge-ongoing { background: rgba(59,130,246, .1); border-color: rgba(59,130,246,.3); color: var(--accent-blue); }
    .badge-ongoing::before { background: var(--accent-blue); }
    .badge-overdue { background: rgba(239,68,68, .1); border-color: rgba(239,68,68,.3); color: var(--danger); }
    .badge-overdue::before { background: var(--danger); }
    .badge-pending { background: rgba(245,158,11, .1); border-color: rgba(245,158,11,.3); color: var(--warning); }
    .badge-pending::before { background: var(--warning); }

    .platform-tag {
      padding: 4px 10px;
      background: rgba(139, 92, 246, 0.1);
      border: 1px solid rgba(139, 92, 246, 0.3);
      border-radius: 6px;
      font-size: 11px;
      font-weight: 600;
      color: var(--accent-purple);
      transition: all 0.3s ease;
    }

    .platform-tag:hover {
      transform: scale(1.05);
      box-shadow: 0 0 8px rgba(139, 92, 246, 0.3);
    }

    .hidden { display: none; }

    /* ====== Animation ====== */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes copyAnimation {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    .copy-animation {
      animation: copyAnimation 0.5s ease;
    }

    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--success);
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      box-shadow: var(--shadow-lg);
      z-index: 1000;
      opacity: 0;
      transform: translateY(-20px);
      transition: all 0.3s ease;
    }

    .notification.show {
      opacity: 1;
      transform: translateY(0);
    }

    /* ====== Responsive ====== */
    @media (max-width: 768px) {
      .navbar-container {
        flex-direction: column;
        gap: 12px;
      }

      .navbar-nav {
        width: 100%;
        flex-wrap: wrap;
        justify-content: center;
      }

      .container { padding: 16px; }
      .header { flex-direction: column; text-align: center; }
      .status-badge { margin-left: 0; }
      .filters-grid { grid-template-columns: 1fr; }
      .kpi-row { grid-template-columns: repeat(2, 1fr); }
      .charts-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <!-- ====== Navbar ====== -->
  <nav class="navbar">
    <div class="navbar-container">
      <a href="index.html" class="navbar-brand">
        <div class="navbar-logo">TV</div>
        <span>TVD Dashboard</span>
      </a>
      <div class="navbar-nav">
        <a href="index.html" class="nav-link">üè† Home</a>
        <a href="dashboard.html" class="nav-link active">üìä Dashboard</a>
        <a href="calendar.html" class="nav-link">üìÖ Calendar</a>
        <a href="lotto.html" class="nav-link">üí∞ Lottery</a>
      </div>
    </div>
  </nav>

  <div class="container">
    <!-- ====== Header ====== -->
    <div class="header">
      <div class="logo">TV</div>
      <div class="header-content">
        <h1>TVD Content Report</h1>
        <div class="header-subtitle">
          ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏° Google Sheet ‚Ä¢ ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå
          <span class="version-badge">Ver.2.0 ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏ä‡∏±‡πà‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏™‡∏•‡∏≤‡∏Å‡∏Å‡∏¥‡∏ô‡πÅ‡∏ö‡πà‡∏á - ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç UI ‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô</span>
        </div>
      </div>
      <div class="status-badge" id="connectionStatus">‚ö° ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...</div>
    </div>

    <!-- ====== Tabs ====== -->
    <div class="nav-tabs">
      <button class="nav-tab active" data-page="dashboard">üìä Dashboard</button>
      <button class="nav-tab" data-page="details">üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô</button>
    </div>

    <!-- ====== Filters ====== -->
    <div class="filters-panel">
      <div class="filters-grid">
        <div class="filter-group">
          <label class="filter-label">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</label>
          <input id="searchInput" type="search" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ Project, Product, Remark...">
        </div>

        <div class="filter-group">
          <label class="filter-label">üì± Platform</label>
          <select id="platformFilter">
            <option value="">‡∏ó‡∏∏‡∏Å‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°</option>
          </select>
        </div>

        <div class="filter-group">
          <label class="filter-label">üë§ Designer</label>
          <select id="designerFilter">
            <option value="">‡∏ó‡∏∏‡∏Å‡∏î‡∏µ‡πÑ‡∏ã‡πÄ‡∏ô‡∏≠‡∏£‡πå</option>
          </select>
        </div>

        <div class="filter-group">
          <label class="filter-label">üìå ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label>
          <select id="statusFilter">
            <option value="">‡∏ó‡∏∏‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</option>
            <option value="‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß">‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</option>
            <option value="‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î">‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î</option>
            <option value="‡πÄ‡∏•‡∏¢‡∏Å‡∏≥‡∏´‡∏ô‡∏î">‡πÄ‡∏•‡∏¢‡∏Å‡∏≥‡∏´‡∏ô‡∏î</option>
            <option value="‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏≥‡∏´‡∏ô‡∏î">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏≥‡∏´‡∏ô‡∏î</option>
          </select>
        </div>

        <div class="filter-group">
          <label class="filter-label">üé® ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô</label>
          <select id="categoryFilter">
            <option value="">‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</option>
            <option value="artwork">Artwork</option>
            <option value="video">Video</option>
            <option value="motion">Motion Graphic</option>
            <option value="script">Script ‡∏≠‡∏≠‡∏Å‡∏Å‡∏≠‡∏á</option>
          </select>
        </div>

        <div class="filter-group">
          <label class="filter-label">üìÖ ‡∏≠‡∏¥‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
          <select id="dateSourceFilter">
            <option value="Finish">Finish</option>
            <option value="Deadline">Deadline</option>
          </select>
        </div>

        <div class="filter-group date-range">
          <div>
            <label class="filter-label">‡∏à‡∏≤‡∏Å</label>
            <input id="dateFrom" type="date">
          </div>
          <div>
            <label class="filter-label">‡∏ñ‡∏∂‡∏á</label>
            <input id="dateTo" type="date">
          </div>
        </div>
      </div>

      <div class="action-buttons">
        <button id="btn7Days">7 ‡∏ß‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</button>
        <button id="btn30Days">30 ‡∏ß‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</button>
        <button id="btnThisMonth">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</button>
        <button id="importBtn">üìÅ ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ CSV</button>
        <button id="copyPNGBtn" class="primary">üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å PNG</button>
        <button id="downloadPNGBtn" class="primary">üíæ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î PNG</button>
        <button id="resetBtn">üîÑ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
      </div>
    </div>

    <!-- ====== Dashboard ====== -->
    <div id="dashboardView">
      <!-- KPI Cards -->
      <div class="kpi-grid">
        <div class="kpi-row">
          <div class="kpi-card">
            <div class="kpi-label">‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
            <div class="kpi-value" id="kpiTotal">0</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-label">‚úÖ ‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</div>
            <div class="kpi-value" id="kpiDone">0</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-label">‚è≥ ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î</div>
            <div class="kpi-value" id="kpiOngoing">0</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-label">‚ö†Ô∏è ‡πÄ‡∏•‡∏¢‡∏Å‡∏≥‡∏´‡∏ô‡∏î</div>
            <div class="kpi-value" id="kpiOverdue">0</div>
          </div>
        </div>
        <div class="kpi-row">
          <div class="kpi-card">
            <div class="kpi-label">üé® Artwork</div>
            <div class="kpi-value" id="kpiArtwork">0</div>
            <!-- NEW: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô Artwork -->
            <div class="kpi-subvalue" id="kpiArtworkPieces">0 ‡∏ä‡∏¥‡πâ‡∏ô</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-label">üé¨ Video</div>
            <div class="kpi-value" id="kpiVideo">0</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-label">‚ú® Motion</div>
            <div class="kpi-value" id="kpiMotion">0</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-label">üìù Script</div>
            <div class="kpi-value" id="kpiScript">0</div>
          </div>
        </div>
      </div>

      <!-- Charts -->
      <div class="charts-grid">
        <div class="chart-card">
          <div class="chart-title">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏á‡∏≤‡∏ô</div>
          <div class="chart-container">
            <canvas id="statusChart"></canvas>
          </div>
        </div>
        <div class="chart-card">
          <div class="chart-title">Platform</div>
          <div class="chart-container">
            <canvas id="platformChart"></canvas>
          </div>
        </div>
        <div class="chart-card">
          <div class="chart-title">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô</div>
          <div class="chart-container">
            <canvas id="typeChart"></canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- ====== Details ====== -->
    <div id="detailsView" class="hidden">
      <div class="table-container">
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th data-sort="__qty">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                <th data-sort="Platform">Platform</th>
                <th data-sort="Product">Product</th>
                <th data-sort="Type">Type</th>
                <th data-sort="Project">Project</th>
                <th data-sort="Remark">Remark</th>
                <th data-sort="Designer">Designer</th>
                <th data-sort="Finish">Finish</th>
                <th data-sort="Deadline">Deadline</th>
                <th data-sort="Status">Status</th>
              </tr>
            </thead>
            <tbody id="tableBody"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Notification -->
  <div class="notification" id="notification"></div>

  <!-- Hidden input for CSV import -->
  <input type="file" id="csvFileInput" accept=".csv" style="display:none" />

  <!-- ====== Libraries ====== -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <!-- ====== App Script ====== -->
  <script>
    /* ==============================
       CONFIG
    =============================== */
    const CONFIG = {
      // ‡∏ß‡∏≤‡∏á URL /exec ‡∏Ç‡∏≠‡∏á Apps Script Web App ‡∏ó‡∏µ‡πà Deploy ‡πÅ‡∏•‡πâ‡∏ß
      SHEET_URL: 'https://script.google.com/macros/s/AKfycbwl-pTotzeMuRwDEmSbdNbt6OeeOR7TUtQKUYqREm-QI8eENIrfN7dWCXBipwIIAubm/exec'
    };

    /* ==============================
       STATE
    =============================== */
    let data = [];
    let filteredData = [];
    let sortKey = 'row';
    let sortDir = 1;
    let charts = {};

    /* ==============================
       HELPERS
    =============================== */
    const TH_MONTHS = {
      "‡∏°.‡∏Ñ.": 1, "‡∏Å.‡∏û.": 2, "‡∏°‡∏µ.‡∏Ñ.": 3, "‡πÄ‡∏°.‡∏¢.": 4, "‡∏û.‡∏Ñ.": 5, "‡∏°‡∏¥.‡∏¢.": 6,
      "‡∏Å.‡∏Ñ.": 7, "‡∏™.‡∏Ñ.": 8, "‡∏Å.‡∏¢.": 9, "‡∏ï.‡∏Ñ.": 10, "‡∏û.‡∏¢.": 11, "‡∏ò.‡∏Ñ.": 12
    };

    function toBool(v) {
      if (typeof v === 'boolean') return v;
      const s = String(v || '').trim().toLowerCase();
      return ['true', '1', 'yes', 'y', '‚úì', 'done'].includes(s);
    }

    function parseThaiDate(str) {
      if (!str) return null;
      const s = String(str).trim();

      // Handle DD/MM/YYYY format from API
      const dmyMatch = s.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);
      if (dmyMatch) {
        const [_, day, month, year] = dmyMatch;
        return new Date(year, month - 1, parseInt(day));
      }

      // Handle ISO format if present
      if (/^\d{4}-\d{2}-\d{2}/.test(s)) {
        const d = new Date(s);
        if (!isNaN(d)) return d;
      }

      // Handle Thai format (1/‡∏ï.‡∏Ñ./25)
      const thMatch = s.match(/(\d{1,2})\s*\/\s*([‡∏Å-‡πõ\.]+)\s*\/\s*(\d{2,4})/);
      if (thMatch) {
        const day = parseInt(thMatch[1]);
        const monthStr = thMatch[2].replace(/\s+/g, '');
        let year = parseInt(thMatch[3]);
        
        const month = TH_MONTHS[monthStr];
        if (!month) return null;
        
        if (year < 100) year = 2000 + year;
        if (year > 2400) year -= 543;
        
        return new Date(year, month - 1, day);
      }

      return null;
    }

    function fmtDateDisplay(v) {
      if (!v) return '-';
      
      // If already in DD/MM/YYYY format, return as is
      if (typeof v === 'string' && /^\d{1,2}\/\d{1,2}\/\d{4}$/.test(v)) {
        return v;
      }
      
      const d = parseThaiDate(v);
      if (!d) return v || '-';
      
      const day = String(d.getDate()).padStart(2, '0');
      const month = String(d.getMonth() + 1).padStart(2, '0');
      const year = d.getFullYear();
      return `${day}/${month}/${year}`;
    }

    // NEW: Function to split platforms
    function splitPlatforms(platformStr) {
      if (!platformStr) return [];
      return platformStr.split(',').map(p => p.trim()).filter(Boolean);
    }

    // NEW: Function to get all unique platforms from data
    function getAllPlatforms(data) {
      const platforms = new Set();
      data.forEach(row => {
        const platformList = splitPlatforms(row.Platform);
        platformList.forEach(p => platforms.add(p));
      });
      return Array.from(platforms).sort();
    }

    function getUniqueValues(arr, key) {
      if (key === 'Platform') {
        return getAllPlatforms(arr);
      }
      return Array.from(
        new Set(arr.map(item => (item?.[key] ?? '').toString().trim()).filter(Boolean))
      ).sort();
    }

    function getCategory(row) {
      const text = [row.Type, row.Remark, row.Project].join(' ').toLowerCase();
      if (text.includes('‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà') || text.includes('re design')) return 'artwork';
      if (text.includes('‡∏ï‡∏±‡∏î‡∏Ñ‡∏•‡∏¥‡∏õ') || text.includes('video')) return 'video';
      if (text.includes('motion')) return 'motion';
      if (text.includes('‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß') || text.includes('script')) return 'script';
      return '';
    }

    // --------- NEW: ‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì (‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡∏¥‡πâ‡∏ô) + ‡∏ï‡∏£‡∏ß‡∏à‡πÅ‡∏ñ‡∏ß‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢ ---------
    function getQty(row){
      const raw = row['‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡∏¥‡πâ‡∏ô'] ?? row['Quantity'] ?? row['qty'] ?? row['Qty'];
      const n = Number(String(raw ?? '').toString().replace(/[, ]/g,'').trim());
      return Number.isFinite(n) && n > 0 ? n : 0;
    }

    // NEW: ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Artwork
    function getArtworkPieces(data) {
      return data
        .filter(row => getCategory(row) === 'artwork')
        .reduce((sum, row) => sum + getQty(row), 0);
    }

    function isMeaningfulRow(r){
      const hasCore =
        [r.Platform, r.Product, r.Project, r.Type, r.Remark].some(v => (v ?? '').toString().trim() !== '');
      const hasAnyDate = !!(parseThaiDate(r.Date) || parseThaiDate(r.Deadline) || parseThaiDate(r.Finish));
      const approved = toBool(r.Approved);
      const hasStatus = (r.Status ?? '').toString().trim() !== '';
      const qty = getQty(r);
      return hasCore || hasAnyDate || hasStatus || approved || qty > 0;
    }

    function computeStatus(row) {
      // 1) Approved wins
      if (toBool(row.Approved)) return '‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß';

      // 2) Existing Status in data (if already normalized)
      if (row.Status) {
        const s = String(row.Status).trim();
        if (['‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß', '‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î', '‡πÄ‡∏•‡∏¢‡∏Å‡∏≥‡∏´‡∏ô‡∏î', '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏≥‡∏´‡∏ô‡∏î'].includes(s)) {
          return s;
        }
      }

      // 3) Finish date
      const finish = row.Finish ? parseThaiDate(row.Finish) : null;
      if (finish) return '‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß';

      // 4) Deadline
      const deadline = row.Deadline ? parseThaiDate(row.Deadline) : null;
      if (deadline) {
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        return deadline < today ? '‡πÄ‡∏•‡∏¢‡∏Å‡∏≥‡∏´‡∏ô‡∏î' : '‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î';
      }

      return '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏≥‡∏´‡∏ô‡∏î';
    }

    // Notification function
    function showNotification(message, type = 'success') {
      const notification = document.getElementById('notification');
      notification.textContent = message;
      notification.style.background = type === 'success' ? 'var(--success)' : 'var(--danger)';
      notification.classList.add('show');
      
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }

    /* ==============================
       LOAD DATA
    =============================== */
    async function loadData() {
      const statusEl = document.getElementById('connectionStatus');

      try {
        if (!CONFIG.SHEET_URL) throw new Error('No URL');

        statusEl.textContent = '‚ö° ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...';

        const res = await fetch(CONFIG.SHEET_URL, { headers: { 'Accept': 'application/json' } });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);

        const result = await res.json();
        const rows = Array.isArray(result) ? result : (result.rows || []);

        // Normalize + ‡∏ï‡∏±‡∏î‡πÅ‡∏ñ‡∏ß‡∏ß‡πà‡∏≤‡∏á‡∏≠‡∏≠‡∏Å
        data = rows.map(r => ({ ...r, Approved: toBool(r.Approved) })).filter(isMeaningfulRow);

        statusEl.textContent = '‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à';
        statusEl.style.background = 'rgba(16, 185, 129, 0.1)';
        statusEl.style.borderColor = 'rgba(16, 185, 129, 0.3)';
        statusEl.style.color = 'var(--success)';
      } catch (error) {
        console.error('Load error:', error);
        data = [];
        statusEl.textContent = '‚ùå ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à';
        statusEl.style.background = 'rgba(239, 68, 68, 0.1)';
        statusEl.style.borderColor = 'rgba(239, 68, 68, 0.3)';
        statusEl.style.color = 'var(--danger)';
      }

      buildFilters();
      applyFilters();
    }

    /* ==============================
       FILTERS
    =============================== */
    function buildFilters() {
      const platformSelect = document.getElementById('platformFilter');
      const designerSelect = document.getElementById('designerFilter');

      platformSelect.innerHTML = '<option value="">‡∏ó‡∏∏‡∏Å‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°</option>';
      designerSelect.innerHTML = '<option value="">‡∏ó‡∏∏‡∏Å‡∏î‡∏µ‡πÑ‡∏ã‡πÄ‡∏ô‡∏≠‡∏£‡πå</option>';

      getUniqueValues(data, 'Platform').forEach(val => {
        const opt = document.createElement('option');
        opt.value = val;
        opt.textContent = val;
        platformSelect.appendChild(opt);
      });

      getUniqueValues(data, 'Designer').forEach(val => {
        const opt = document.createElement('option');
        opt.value = val;
        opt.textContent = val;
        designerSelect.appendChild(opt);
      });
    }

    function applyFilters() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      const platformFilter = document.getElementById('platformFilter').value;
      const designerFilter = document.getElementById('designerFilter').value;
      const statusFilter = document.getElementById('statusFilter').value;
      const categoryFilter = document.getElementById('categoryFilter').value;
      const dateSource = document.getElementById('dateSourceFilter').value;
      const dateFrom = document.getElementById('dateFrom').value;
      const dateTo = document.getElementById('dateTo').value;

      filteredData = data.filter(row => {
        // Search
        if (searchTerm) {
          const searchable = [
            row.Project, row.Product, row.Remark, row.Type, row.Designer
          ].join(' ').toLowerCase();
          if (!searchable.includes(searchTerm)) return false;
        }

        // Platform - NEW: Check if any platform in the list matches
        if (platformFilter) {
          const platforms = splitPlatforms(row.Platform);
          if (!platforms.includes(platformFilter)) return false;
        }

        // Designer
        if (designerFilter && row.Designer !== designerFilter) return false;

        // Status
        const status = computeStatus(row);
        if (statusFilter && status !== statusFilter) return false;

        // Category
        if (categoryFilter) {
          const category = getCategory(row);
          if (category !== categoryFilter) return false;
        }

        // Date range
        if (dateFrom || dateTo) {
          const dateField = row[dateSource];
          const date = parseThaiDate(dateField);
          if (!date) return false;

          const from = dateFrom ? new Date(dateFrom) : null;
          const to = dateTo ? new Date(dateTo) : null;

          if (from && date < from) return false;
          if (to && date > to) return false;
        }

        return true;
      });

      updateUI();
    }

    /* ==============================
       SORT
    =============================== */
    function sortData() {
      if (!sortKey) return;

      filteredData.sort((a, b) => {
        let valA = a[sortKey] ?? '';
        let valB = b[sortKey] ?? '';

        // Handle platform sorting - NEW: Sort by first platform in the list
        if (sortKey === 'Platform') {
          const platformsA = splitPlatforms(valA);
          const platformsB = splitPlatforms(valB);
          valA = platformsA.length > 0 ? platformsA[0] : '';
          valB = platformsB.length > 0 ? platformsB[0] : '';
        }

        // Handle date sorting
        if (['Date', 'Deadline', 'Finish'].includes(sortKey)) {
          const dateA = parseThaiDate(valA);
          const dateB = parseThaiDate(valB);
          if (dateA && dateB) return sortDir * (dateA - dateB);
          if (dateA) return -1 * sortDir;
          if (dateB) return 1 * sortDir;
          return 0;
        }

        // Handle numeric sorting
        if (sortKey === '__qty') {
          const qtyA = getQty(a);
          const qtyB = getQty(b);
          return sortDir * (qtyA - qtyB);
        }

        // Default string sorting
        return sortDir * String(valA).localeCompare(String(valB), 'th');
      });
    }

    /* ==============================
       UPDATE UI
    =============================== */
    function updateUI() {
      sortData();
      updateKPI();
      updateCharts();
      updateTable();
    }

    function updateKPI() {
      const total = filteredData.length;
      const done = filteredData.filter(r => computeStatus(r) === '‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß').length;
      const ongoing = filteredData.filter(r => computeStatus(r) === '‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î').length;
      const overdue = filteredData.filter(r => computeStatus(r) === '‡πÄ‡∏•‡∏¢‡∏Å‡∏≥‡∏´‡∏ô‡∏î').length;

      const artwork = filteredData.filter(r => getCategory(r) === 'artwork').length;
      const video = filteredData.filter(r => getCategory(r) === 'video').length;
      const motion = filteredData.filter(r => getCategory(r) === 'motion').length;
      const script = filteredData.filter(r => getCategory(r) === 'script').length;

      document.getElementById('kpiTotal').textContent = total;
      document.getElementById('kpiDone').textContent = done;
      document.getElementById('kpiOngoing').textContent = ongoing;
      document.getElementById('kpiOverdue').textContent = overdue;
      document.getElementById('kpiArtwork').textContent = artwork;
      document.getElementById('kpiVideo').textContent = video;
      document.getElementById('kpiMotion').textContent = motion;
      document.getElementById('kpiScript').textContent = script;
      
      // NEW: ‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô Artwork
      const artworkPieces = getArtworkPieces(filteredData);
      document.getElementById('kpiArtworkPieces').textContent = `${artworkPieces} ‡∏ä‡∏¥‡πâ‡∏ô`;
    }

    function updateCharts() {
      // Status chart
      const statusCounts = {
        '‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß': 0,
        '‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î': 0,
        '‡πÄ‡∏•‡∏¢‡∏Å‡∏≥‡∏´‡∏ô‡∏î': 0,
        '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏≥‡∏´‡∏ô‡∏î': 0
      };

      filteredData.forEach(row => {
        const status = computeStatus(row);
        statusCounts[status]++;
      });

      // Platform chart - NEW: Count each platform separately
      const platformCounts = {};
      filteredData.forEach(row => {
        const platforms = splitPlatforms(row.Platform);
        platforms.forEach(p => {
          platformCounts[p] = (platformCounts[p] || 0) + 1;
        });
      });

      // Type chart
      const typeCounts = {
        'artwork': 0,
        'video': 0,
        'motion': 0,
        'script': 0
      };

      filteredData.forEach(row => {
        const category = getCategory(row);
        if (category && typeCounts.hasOwnProperty(category)) {
          typeCounts[category]++;
        }
      });

      // Update or create charts
      updateChart('statusChart', Object.keys(statusCounts), Object.values(statusCounts), ['#10b981', '#3b82f6', '#ef4444', '#6b7280']);
      updateChart('platformChart', Object.keys(platformCounts), Object.values(platformCounts), ['#8b5cf6', '#06b6d4', '#f59e0b', '#3b82f6', '#10b981', '#ef4444']);
      updateChart('typeChart', ['Artwork', 'Video', 'Motion', 'Script'], Object.values(typeCounts), ['#8b5cf6', '#06b6d4', '#3b82f6', '#10b981']);
    }

    function updateChart(canvasId, labels, data, colors) {
      const ctx = document.getElementById(canvasId).getContext('2d');

      if (charts[canvasId]) {
        charts[canvasId].destroy();
      }

      // NEW: Custom chart configurations based on type
      const commonOptions = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'bottom',
            labels: {
              color: '#e8eaf0',
              padding: 20,
              usePointStyle: true,
              font: { 
                size: 13,
                family: "'Inter', 'Noto Sans Thai', system-ui"
              }
            }
          },
          tooltip: {
            backgroundColor: 'rgba(15, 20, 35, 0.9)',
            titleFont: {
              size: 14,
              family: "'Inter', 'Noto Sans Thai', system-ui"
            },
            bodyFont: {
              size: 13,
              family: "'Inter', 'Noto Sans Thai', system-ui"
            },
            padding: 12,
            cornerRadius: 8,
            displayColors: true,
            usePointStyle: true,
            callbacks: {
              label: function(context) {
                const value = context.raw;
                const percentage = ((value / data.reduce((a, b) => a + b, 0)) * 100).toFixed(1);
                return ` ${context.label}: ${value} (${percentage}%)`;
              }
            }
          }
        },
        animation: {
          animateScale: true,
          animateRotate: true,
          delay: (context) => context.dataIndex * 100
        }
      };

      // Specific configurations for each chart
      const chartConfigs = {
        'statusChart': {
          type: 'doughnut',
          options: {
            ...commonOptions,
            cutout: '75%',
            radius: '90%'
          }
        },
        'platformChart': {
          type: 'polarArea',
          options: {
            ...commonOptions,
            scales: {
              r: {
                ticks: { display: false },
                grid: { 
                  color: 'rgba(255,255,255,0.05)',
                  lineWidth: 1
                }
              }
            },
            startAngle: -30
          }
        },
        'typeChart': {
          type: 'bar',
          options: {
            ...commonOptions,
            indexAxis: 'y',
            scales: {
              x: {
                grid: {
                  color: 'rgba(255,255,255,0.05)',
                  lineWidth: 1
                },
                ticks: { 
                  color: '#9ca3af',
                  font: { size: 12 }
                }
              },
              y: {
                grid: { display: false },
                ticks: { 
                  color: '#e8eaf0',
                  font: { size: 13 }
                }
              }
            },
            plugins: {
              ...commonOptions.plugins,
              legend: { display: false }
            }
          }
        }
      };

      const config = chartConfigs[canvasId];
      
      charts[canvasId] = new Chart(ctx, {
        type: config.type,
        data: {
          labels: labels,
          datasets: [{
            data: data,
            backgroundColor: colors.map(c => `${c}CC`),
            borderColor: colors,
            borderWidth: 2,
            borderRadius: config.type === 'bar' ? 4 : 0,
            hoverOffset: 15,
            hoverBorderWidth: 0
          }]
        },
        options: config.options
      });
    }

    function updateTable() {
      const tbody = document.getElementById('tableBody');
      tbody.innerHTML = '';

      filteredData.forEach((row, index) => {
        const tr = document.createElement('tr');
        tr.style.setProperty('--row-index', index + 1);
        const status = computeStatus(row);
        const category = getCategory(row);
        const qty = getQty(row);

        // NEW: Render platforms as separate tags
        const platforms = splitPlatforms(row.Platform);
        const platformTags = platforms.map(p => 
          `<span class="platform-tag">${p}</span>`
        ).join(' ');

        tr.innerHTML = `
          <td>${qty}</td>
          <td>${platformTags}</td>
          <td>${row.Product || '-'}</td>
          <td>${row.Type || '-'}</td>
          <td>${row.Project || '-'}</td>
          <td>${row.Remark || '-'}</td>
          <td>${row.Designer || '-'}</td>
          <td>${fmtDateDisplay(row.Finish)}</td>
          <td>${fmtDateDisplay(row.Deadline)}</td>
          <td><span class="badge badge-${status === '‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß' ? 'done' : status === '‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î' ? 'ongoing' : status === '‡πÄ‡∏•‡∏¢‡∏Å‡∏≥‡∏´‡∏ô‡∏î' ? 'overdue' : 'pending'}">${status}</span></td>
        `;
        tbody.appendChild(tr);
      });
    }

    /* ==============================
       PNG EXPORT FUNCTIONS
    =============================== */
    async function capturePNG(download = false) {
      const button = download ? document.getElementById('downloadPNGBtn') : document.getElementById('copyPNGBtn');
      button.classList.add('copy-animation');
      
      try {
        const isDashboard = !document.getElementById('dashboardView').classList.contains('hidden');
        const elementToCapture = isDashboard ? document.getElementById('dashboardView') : document.getElementById('detailsView');
        
        // Create a clone of the element to capture
        const clone = elementToCapture.cloneNode(true);
        
        // Create wrapper with fixed width to maintain layout
        const wrapper = document.createElement('div');
        wrapper.style.cssText = `
          position: fixed;
          left: -9999px;
          width: 1400px;
          padding: 40px;
          background: radial-gradient(ellipse at top, #1e293b 0%, var(--bg-primary) 50%);
          z-index: -1;
        `;
        
        // Reset any responsive styles in the clone
        clone.style.cssText = `
          width: 100% !important;
          max-width: none !important;
          transform: none !important;
          transition: none !important;
        `;
        
        // Ensure charts maintain size
        clone.querySelectorAll('.chart-card').forEach(card => {
          card.style.height = '400px';
        });
        
        wrapper.appendChild(clone);
        document.body.appendChild(wrapper);
        
        // Wait for charts to render
        await new Promise(resolve => setTimeout(resolve, 100));
        
        const canvas = await html2canvas(wrapper, {
          backgroundColor: null,
          scale: 2,
          useCORS: true,
          allowTaint: true,
          logging: false,
          width: 1400,
          height: wrapper.offsetHeight
        });
        
        // Clean up
        document.body.removeChild(wrapper);
        
        if (download) {
          const link = document.createElement('a');
          const timestamp = new Date().toISOString().slice(0, 10);
          const type = isDashboard ? 'dashboard' : 'details';
          link.download = `tvd-report-${type}-${timestamp}.png`;
          link.href = canvas.toDataURL('image/png');
          link.click();
          showNotification('‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î PNG ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
        } else {
          canvas.toBlob(async (blob) => {
            try {
              await navigator.clipboard.write([
                new ClipboardItem({
                  'image/png': blob
                })
              ]);
              showNotification('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏†‡∏≤‡∏û‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏Ñ‡∏•‡∏¥‡∏õ‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÅ‡∏•‡πâ‡∏ß!', 'success');
            } catch (err) {
              console.error('Failed to copy image: ', err);
              showNotification('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏†‡∏≤‡∏û‡πÑ‡∏î‡πâ', 'error');
            }
          });
        }
      } catch (error) {
        console.error('Error capturing PNG:', error);
        showNotification('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏†‡∏≤‡∏û', 'error');
      } finally {
        setTimeout(() => {
          button.classList.remove('copy-animation');
        }, 500);
      }
    }

    /* ==============================
       EVENT LISTENERS
    =============================== */
    function initEvents() {
      // Tabs
      document.querySelectorAll('.nav-tab').forEach(tab => {
        tab.addEventListener('click', () => {
          const page = tab.dataset.page;
          document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          document.getElementById('dashboardView').classList.toggle('hidden', page !== 'dashboard');
          document.getElementById('detailsView').classList.toggle('hidden', page !== 'details');
        });
      });

      // Filters
      document.querySelectorAll('input, select').forEach(el => {
        el.addEventListener('change', applyFilters);
      });
      document.getElementById('searchInput').addEventListener('input', applyFilters);

      // Sort
      document.querySelectorAll('th[data-sort]').forEach(th => {
        th.addEventListener('click', () => {
          const key = th.dataset.sort;
          if (sortKey === key) {
            sortDir *= -1;
          } else {
            sortKey = key;
            sortDir = 1;
          }
          updateUI();
        });
      });

      // Date shortcuts
      document.getElementById('btn7Days').addEventListener('click', () => {
        const to = new Date();
        const from = new Date();
        from.setDate(to.getDate() - 7);
        document.getElementById('dateFrom').value = from.toISOString().split('T')[0];
        document.getElementById('dateTo').value = to.toISOString().split('T')[0];
        applyFilters();
      });

      document.getElementById('btn30Days').addEventListener('click', () => {
        const to = new Date();
        const from = new Date();
        from.setDate(to.getDate() - 30);
        document.getElementById('dateFrom').value = from.toISOString().split('T')[0];
        document.getElementById('dateTo').value = to.toISOString().split('T')[0];
        applyFilters();
      });

      document.getElementById('btnThisMonth').addEventListener('click', () => {
        const now = new Date();
        const from = new Date(now.getFullYear(), now.getMonth(), 1);
        const to = new Date(now.getFullYear(), now.getMonth() + 1, 0);
        document.getElementById('dateFrom').value = from.toISOString().split('T')[0];
        document.getElementById('dateTo').value = to.toISOString().split('T')[0];
        applyFilters();
      });

      document.getElementById('resetBtn').addEventListener('click', () => {
        document.querySelectorAll('input, select').forEach(el => {
          if (el.type === 'date') el.value = '';
          else if (el.tagName === 'SELECT') el.selectedIndex = 0;
          else el.value = '';
        });
        applyFilters();
      });

      // Import CSV
      document.getElementById('importBtn').addEventListener('click', () => {
        document.getElementById('csvFileInput').click();
      });

      document.getElementById('csvFileInput').addEventListener('change', handleCSVImport);

      // PNG Export
      document.getElementById('copyPNGBtn').addEventListener('click', () => capturePNG(false));
      document.getElementById('downloadPNGBtn').addEventListener('click', () => capturePNG(true));
    }

    function handleCSVImport(e) {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(event) {
        const csvText = event.target.result;
        const rows = parseCSV(csvText);
        
        // Simple mapping - adjust as needed
        const mappedData = rows.map(row => ({
          Platform: row['Platform'],
          Product: row['Product'],
          Type: row['Type'],
          Project: row['Project'],
          Remark: row['Remark'],
          Designer: row['Designer'],
          Date: row['Date'],
          Deadline: row['Deadline'],
          Status: row['Status'],
          Approved: toBool(row['Approved']),
          Finish: row['Finish']
        }));

        data = mappedData.filter(isMeaningfulRow);
        buildFilters();
        applyFilters();
        showNotification(`‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${data.length} ‡πÅ‡∏ñ‡∏ß`, 'success');
      };
      reader.readAsText(file);
      e.target.value = '';
    }

    function parseCSV(text) {
      const lines = text.split('\n').map(line => line.trim()).filter(Boolean);
      if (lines.length < 2) return [];

      const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
      const result = [];

      for (let i = 1; i < lines.length; i++) {
        const values = lines[i].split(',').map(v => v.trim().replace(/"/g, ''));
        const row = {};
        headers.forEach((header, index) => {
          row[header] = values[index] || '';
        });
        result.push(row);
      }

      return result;
    }

    /* ==============================
       INIT
    =============================== */
    function init() {
      initEvents();
      loadData();
    }

    // Start the app
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
